# Mise configuration for terraform-homelab
min_version = "2024.9.5"

[settings]
auto_install = true
not_found_auto_install = true
task_run_auto_install = true

[settings.status]
show_tools = true
show_env = false
truncate = true

[tools]
eza = "0.23.0"
fd = "10.2.0"
rg = "14.1.1"
git-cliff = "2.10.1"
shellcheck = "0.11.0"
lychee = "0.22.0"
prek = "0.2.13"

# === Changelog tasks ===
[tasks.changelog]
description = "Update unreleased section of CHANGELOG.md"
run = """
set -euo pipefail
echo "üìù Updating CHANGELOG.md with unreleased changes..."

# Check if CHANGELOG.md exists
if [ ! -f CHANGELOG.md ]; then
  echo "‚ö†Ô∏è  CHANGELOG.md not found. Generating initial changelog..."
  git-cliff -o CHANGELOG.md
  echo "‚úÖ Initial CHANGELOG.md created!"
  exit 0
fi

# Regenerate the entire changelog to include new unreleased commits
git-cliff -o CHANGELOG.md
echo "‚úÖ CHANGELOG.md updated!"
"""


# === Hooks tasks ===
[tasks.hooks-install]
description = "Install prek and infisical hooks"
run = "prek install -f && infisical scan install --pre-commit-hook"

[tasks.pre-commit-run]
description = "Run prek hooks"
run = "prek run --all-files"

# === Infisical tasks ===
[tasks.infisical-scan]
description = "Scan repository for secrets and sensitive data"
run = "infisical scan"

[tasks.markdown-lint]
description = "Lint Markdown files"
run = "rumdl check ."

[tasks.markdown-fix]
description = "Fix Markdown files"
run = "rumdl fmt ."

[tasks.validate-renovate-root]
description = "Validate Renovate configuration"
run = "npx --yes --package renovate -- renovate-config-validator --strict default.json renovate.json"

[tasks.validate-renovate-presets]
description = "Validate Renovate presets"
dir = "presets"
run = "npx --yes --package renovate -- renovate-config-validator --strict *.json"
